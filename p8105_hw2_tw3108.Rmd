---
title: "p8105_hw2_tw3108"
author: "Tao Wu"
date: "2025-10-01"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r,message=FALSE,warning=FALSE}
library(tidyverse)
pols <- read_csv("data/pols-month.csv")
snp  <- read_csv("data/snp.csv")
unemp <- read_csv("data/unemployment.csv")
newpols <- pols %>%
  separate(mon, into = c("year", "month", "day"), sep = "-") %>%
  mutate(
    month = as.integer(month),
    month = month.name[month],
    president = if_else(prez_gop == 1, "gop", "dem")
  ) %>%
  select(-prez_gop, -prez_dem, -day)
newsnp <- snp %>%
 mutate(date = as.Date(date, format = "%m/%d/%y"),
    year = as.integer(format(date, "%Y")),
    month = as.integer(format(date, "%m")),
    month = month.name[month]
  ) %>%
  select(year, month, close) %>%    
  arrange(year, month)
newunemp <- unemp %>%
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "rate"
  ) %>%
  mutate(
    year  = as.integer(Year),
    month = month.name[match(month,month.abb)]
  ) %>%
  select(year, month, rate) %>%
  arrange(year,month)
newpols   <- newpols   %>% mutate(year = as.integer(year))
newsnp    <- newsnp    %>% mutate(year = as.integer(year))
newunemp  <- newunemp  %>% mutate(year = as.integer(year))
merged <- newpols %>%
  left_join(newsnp, by = c("year", "month"))
final <- merged %>%
  left_join(newunemp, by = c("year", "month"))
```

For this question,we can get each datasets' information on the data description page.pols-month ontains 822 observations of 9 variables related to the number of national politicians who are democratic or republican at any given time.snp contains 787 observations of 2 variables related to Standard & Poor’s stock market index (S&P). The file “unemployment” contains 68 observations of 13 variables about the unemployment rate in US. After cleaning and merging, the resulting dataset final include `r nrow(final)`  observations, covering the time period from `r min(final$year)` to `r max(final$year)`. Key variables 
include `year`, `month`, `president` , `close` , and `rate`. 

```{r,message=FALSE,warning=FALSE}
library(readxl)
library(dplyr)
data <- "data/202409 Trash Wheel Collection Data.xlsx"

mrtrash <- read_excel(
  data,
  sheet = "Mr. Trash Wheel",
  skip  = 1,
  range = readxl::cell_cols("A:M")
) %>%
  filter(!is.na(Dumpster)) %>%
  rename(
    weight_tons         = `Weight (tons)`,
    volume_cubic_yards  = `Volume (cubic yards)`,
    plastic_bottles     = `Plastic Bottles`,
    polystyrene         = Polystyrene,
    cigarette_butts     = `Cigarette Butts`,
    glass_bottles       = `Glass Bottles`,
    plastic_bags        = `Plastic Bags`,
    wrappers            = Wrappers,
    sports_balls        = `Sports Balls`
  ) %>%
  mutate(
    Year           = as.integer(Year),
    Month          = as.character(Month),
    Date           = as.Date(Date),
    weight_tons    = as.numeric(weight_tons),
    cigarette_butts= as.numeric(cigarette_butts),
    sports_balls   = as.integer(round(as.numeric(sports_balls))),
    member         = "Mr.Trash Wheel"
  )

proftrash <- read_excel(
  data,
  sheet = "Professor Trash Wheel",
  skip  = 1,
  range = readxl::cell_cols("A:M")
) %>%
  filter(!is.na(Dumpster)) %>%
  rename(
    weight_tons         = `Weight (tons)`,
    volume_cubic_yards  = `Volume (cubic yards)`,
    plastic_bottles     = `Plastic Bottles`,
    polystyrene         = Polystyrene,
    cigarette_butts     = `Cigarette Butts`,
    glass_bottles       = `Glass Bottles`,
    plastic_bags        = `Plastic Bags`,
    wrappers            = Wrappers
  ) %>%
  mutate(
    Year           = as.integer(Year),
    Month          = as.character(Month),
    Date           = as.Date(Date),
    weight_tons    = as.numeric(weight_tons),
    cigarette_butts= as.numeric(cigarette_butts),
    sports_balls   = NA_integer_, 
    member         = "Professor Trash Wheel"
  )

gwynnda <- read_excel(
  data,
  sheet = "Gwynnda Trash Wheel",
  skip  = 1,
  range = readxl::cell_cols("A:L")
) %>%
  filter(!is.na(Dumpster)) %>%
  rename(
    weight_tons         = `Weight (tons)`,
    volume_cubic_yards  = `Volume (cubic yards)`,
    plastic_bottles     = `Plastic Bottles`,
    polystyrene         = Polystyrene,
    cigarette_butts     = `Cigarette Butts`,
    plastic_bags        = `Plastic Bags`,
    wrappers            = Wrappers
  ) %>%
  mutate(
    Year           = as.integer(Year),
    Month          = tolower(as.character(Month)),
    Date           = as.Date(Date),
    weight_tons    = as.numeric(weight_tons),
    cigarette_butts= as.numeric(cigarette_butts),
    sports_balls   = NA_integer_,   
    member         = "Gwynnda"
  )

trashwheel <- bind_rows(mrtrash, proftrash, gwynnda)
totalweight <- sum(trashwheel$weight_tons[trashwheel$member == "Professor Trash Wheel"])
cigs <- sum(trashwheel$cigarette_butts[
  trashwheel$member == "Gwynnda" & format(trashwheel$Date, "%Y-%m") == "2022-06"
])
```

The Trash Wheel dataset combines information from the `Mr. Trash Wheel`, `Professor Trash Wheel`, and `Gwynnda` in Baltimore. Each observation corresponds to a dumpster of trash, and key variables include the date of collection, the amount of trash collected, and counts of specific types of litter, such as cigarette butts, and sports balls. The combined dataset `trashwheel` contains `r nrow(trashwheel)` observations.  As given by data, `Professor Trash Wheel` collected a total of 
`r totalweight` tons of trash over the available time period. In June 2022, Gwynnda collected `r cigs` cigarettes in the water.
 


```{r,message=FALSE,warning=FALSE}
library(tidyverse)
zori <- readr::read_csv("data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv")
newzori <- zori %>%
  rename(zip = RegionName) %>%
  pivot_longer(
    cols = -(1:9),
    names_to  = "date",
    values_to = "zori"
  ) %>%
  tidyr::separate(
    date, into = c("year","month","day"),
    sep = "-", convert = TRUE
  ) %>%
  mutate(
    date = as.Date(year, month, day),
  ) %>%
  select(zip, date, year, month, zori) %>%
  arrange(zip, date)
zip <- read_csv("data/Zip Codes.csv") %>%
  rename(zip = ZipCode, county= County,neighborhood = Neighborhood
  )
tidy <- newzori %>%
  left_join(zip, by = "zip") %>%
  relocate(zip, county, neighborhood, date, year, month, zori) %>%
  arrange(zip, date)
 obs <- nrow(tidy)
 zipnum <- n_distinct(tidy$zip)
 neibor <- n_distinct(tidy$neighborhood)
 range <- range(tidy$date)
ziponly <- zip %>%
  filter(!(zip %in% newzori$zip))
exp <- head(ziponly, 10)
onlynum <- nrow(ziponly)
zori2020 <- tidy %>%
  filter(year == 2020, month == 1) %>%
  select(zip, zori2020 = zori)
zori2021 <- tidy %>%
  filter(year == 2021, month == 1) %>%
  select(zip, zori2021 = zori)
diff <- zori2020 %>%
  inner_join(zori2021, by = "zip") %>%
  mutate(diff = zori2021 - zori2020) %>%
  left_join(distinct(tidy, zip, county, neighborhood), by = "zip") %>%
  arrange(diff) %>%
 head(n = 10)
knitr::kable(
  diff %>%
    select(zip, county, neighborhood, zori2020, zori2021, diff),
)
```
  the final tidy dataset contains `r obs` observations, covering `r zipnum` unique ZIP codes and `r neibor` unique neighborhoods.
The time span ranges from `r range[1]` to `r range[2]`. Key variables include zip, county, neighborhood, date, year, month, and zori
Several zip codes appear in the reference dataset but not in the zori dataset,there are `r onlynum` of them. I think it maybe becuase there are some newly registered zip or zip is changed? However, the table shows that the rent index has been clearly lowered during the year of 2021,I think it maybe due to the COVID 19 had influence on the housing market. 
